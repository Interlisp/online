//-
    /***************************************************************************
     *
     *   help_dialogs.pug: help dialogs for online.interlisp.org web portal.
     *                     Meant to be included in other pug files.
     *
     *
     *   2022-02-08 Frank Halasz
     *
     *
     *   Copyright: 2022 by Interlisp.org
     *
     *
     **************************************************************************/

link(rel="stylesheet", href="/stylesheets/help_dialogs.css")


script.
    function helpOnClick(which) {
        document.getElementById(`help-dialog-${which}`).showModal();
    }

    function helpDialogClose (which) {
        document.getElementById("help-dialog-" + which).close();
    }

dialog(id="help-dialog-guest").help-dialog
    h2  Help
    p.
        Guest login will give you full access to the Interlisp environment for a
        single session.  No data or files are saved between guest login sessions.
    p.
        If you wish to save your Interlisp session or to save files across sessions,
        you must register and login using your email address.
    .single-button-div
        button(type="button" onclick='helpDialogClose("guest");').main-button OK

dialog(id="help-dialog-resume").help-dialog
    h2  Help
    p.
        Ordinarily, "Start Interlisp" will start up Interlisp using the standard full.sysout from the latest Medley release.
    p.
        Checking this option will cause "Start Interlisp" to instead restart your latest session using the retained
        lisp.virtualmem.
    p.
        If there is no retained lisp.virtualmem, startup will be from full.sysout.
    .single-button-div
        button(type="button" onclick='helpDialogClose("resume");').main-button OK

dialog(id="help-dialog-custom").help-dialog
    h2  Help
    p.
        Ordinarily, "Start Interlisp" will start up Interlisp using the standard full.sysout from the latest Medley release.
    p.
        Checking this option will cause "Start Interlisp" to instead start up using the custom sysout stored at ~/il/sysout/online.sysout
        in your online.interlisp.org home directory.
    p.
        You can create this sysout using the online Interlisp environment or you
        can upload (and rename) any Medley sysout using the sftp feature.
    p.
        If ~/il/sysout/online.sysout does not exist, the standard full.sysout will be used instead.
    .single-button-div
        button(type="button" onclick='helpDialogClose("custom");').main-button OK

dialog(id="help-dialog-run_notecards").help-dialog
    h2  Help
    p.
        If this option is checked, the Notecards app will be loaded and started up when Interlisp is started.
    p.
        If this is the first time Notecards has been run, demo notefiles will be placed in your home directory at
        ~/il/notefiles.
    p.
        This option is disabled if "Resume previous session" is checked.
    .single-button-div
        button(type="button" onclick='helpDialogClose("run_notecards");').main-button OK

dialog(id="help-dialog-run_rooms").help-dialog
    h2  Help
    p.
        If this option is checked, the Rooms app will be loaded and started up when Interlisp is started.
    p.
        This option is disabled if "Resume previous session" is checked.
    .single-button-div
        button(type="button" onclick='helpDialogClose("run_rooms");').main-button OK

dialog(id="help-dialog-sftp").help-dialog
    h2  Help
    p.
        Checking this option will cause "Start Interlisp" and "Start Terminal Session" to also start up an SFTP server on online.interlisp.org.
        This SFTP server can be used to upload or download files to/from your online.interlisp.org home directory using any standard SFTP client
        (e.g., FileZilla).
    p.
        The port#, username and password for accessing the SFTP server are given in the WHO-LINE window in the Interlisp 
        environment or at the top of the terminal window in the Terminal Session environment.
    .single-button-div
        button(type="button" onclick='helpDialogClose("sftp");').main-button OK

dialog(id="help-dialog-custom-init").help-dialog
    h2  Help
    p.
        Ordinarily, "Start Interlisp" will start up Interlisp using the standard ONLINE-INIT from the latest Medley release.
    p.
        Checking this option will cause "Start Interlisp" to instead start up using the custom sysout stored at ~/il/initdir/ONLINE-INIT or 
        ~/il/initdir/ONLINE-INIT.LCOM in your online.interlisp.org home directory.
    p.
        You can create this custom init file using the online Interlisp environment or you
        can upload any Medley sysout using the File Manager feature.
    p.
        If ~/il/init/ONLINE-INIT(.LCOM) does not exist, the standard ONLINE-INIT will be used instead.
    .single-button-div
        button(type="button" onclick='helpDialogClose("custom-init");').main-button OK

dialog(id="help-dialog-which-exec").help-dialog
    h2  Help
    p.
        Medley supports both Interlisp and Common Lisp.  The system starts up with a single Exec window running a
        read-eval-print loop (REPL) for executing Lisp.  This Exec window can be either Interlisp- or Common Lisp-based. 
    p.
        This option selects whether the initial Exec window is Interlisp- or Common Lisp-based.
    p.
        Additional Exec windows based on either Interlisp or Common Lisp can be started at any time from the background menu.
    .single-button-div
        button(type="button" onclick='helpDialogClose("which-exec");').main-button OK
dialog(id="help-dialog-start-script").help-dialog
    h2  Help
    p.
        A start-script if a Medley Lisp file that will be LOADed at the end of the ONLINE-INIT script while Online
        Medley is starting up.  It can be used to fetch other files from the Internet and/or to run code that will
        set-up the Medley environment or start a specific Medley application.  This is generally used for automatings
        demos.  Example start-scripts can be found at https://github.com/interlisp/online/start-scripts. 
    p.
        In this field enter a URL that points to a Medley Lisp file that can be downloaded from the Internet with
        wget.  This file will be downloaded amd LOADed at the end of ONLINE-INIT.
    .single-button-div
        button(type="button" onclick='helpDialogClose("start-script");').main-button OK

//-
    /***************************************************************************
     *
     *   main.pug:   "main" page for online.interlisp.org web portal.
     *               This is where the user starts up interlisp, etc.,
     *
     *   2021-11-22 Frank Halasz
     *
     *
     *   Copyright: 2021-2022 by Interlisp.org
     *
     *
     **************************************************************************/
 
extends layout

block variables

block headeradds

    script.
        const isGuest = #{isGuest};
        const isVerified = #{isVerified};
        const nodisclaimer = #{nodisclaimer};
        const isAutoLogin = #{isAutoLogin};
        const alNotecards = #{notecards};
        const alRooms = #{rooms};
        const alURL = "#{alURL}";
        const alStart = "#{start}";

    link(rel="stylesheet", href="/stylesheets/main.css")

    script(src="/js/main.js")
        

block content
    .row.text-center#logged-in-as
        form#dummy002(method="POST" action="/user/logout" style="display:none")
        != `Logged in as: ${login}.<a id="logout-a" onclick="document.getElementById('dummy002').submit();"><span id="logout-span">LOGOUT</span></a>` 

    .row.text-center#run-button
        button.main-button(type="button" onclick='startSession("interlisp");')!= "Run " + (isNCO ? "Notecards" : "Medley")
    
    .row.text-center#run-options
        table#ro-table
          thead
            tr
              th#ro-col1
              th#ro-col2
              th#ro-col3
          tbody
            //- Resume on click
            tr#resume_row
              td
              td
                label.run-option.
                  <input type="checkbox" id="resume_cb" onclick="resumeOnClick()" class="checkbox-input">&nbsp;Resume previous session
              td
                span.in-circle(onclick='helpOnClick("resume");') ?
            <tr id="resume_rule"><td></td><td><hr></td><td></td></tr>
            tr#initial_exec_row
              //- Initial Exec
              td
              td
                table
                  tr
                    td(rowspan="2").
                      Initial Exec:
                    td(style="text-align:left;")
                      label.
                        <input type="radio" id="interlisp_rb" name="which-exec" class="checkbox-input" checked>&nbsp;Interlisp
                  tr
                    td(style="text-align:left;")           
                      label.
                      <input type="radio" id="commonlisp_rb" name="which-exec" class="checkbox-input">&nbsp;Common Lisp
              td
                span.in-circle(onclick='helpOnClick("which-exec");') ?
            <tr id="initial_exec_rule"><td></td><td><hr></td><td></td></tr>
            tr#run_notecards_row
              //- Run Notecards
              td
              td              
                label.run-option.
                  <input type="checkbox" id="run_notecards_cb" class="checkbox-input">&nbsp;Run Notecards
              td
                span.in-circle(onclick='helpOnClick("run_notecards");') ?
            <tr id="run_notecards_rule"><td></td><td><hr></td><td></td></tr>
            tr#run_rooms_row
              //- Run Rooms
              td
              td              
                label.run-option.
                  <input type="checkbox" id="run_rooms_cb" class="checkbox-input">&nbsp;Run Rooms
              td
                span.in-circle(onclick='helpOnClick("run_rooms");') ?
            <tr id="run_rooms_rule"><td></td><td><hr></td><td></td></tr>
            tr
              //- Screen Width and Height
              td
              td#wh-cell              
                div
                  label Screen Width:&nbsp;
                    input(type="number", id="screen-width", class="number-input", value=1024, min=100, max=9999)
                div
                  label Screen Height:&nbsp;
                    input(type="number", id="screen-height", class="number-input", value=808, min=100, max=9999)
                #fill-window-label
                  label.
                    <input type="checkbox" id="fill_window_cb" onclick="fillWindowOnClick()">&nbsp;Fill browser window
              td
            <tr><td></td><td><hr></td><td></td></tr>

    .row#dev-div(style="display:none;")
      .text-center#dev-div-checkbox
        label.
          <input type="checkbox" id="dev-options-checkbox" onclick="showDevOptionsOnClick();" class="checkbox-input">&nbsp;Show advanced options
      #dev-div-controls(style="display:none;")
        #start_script_row
          label.run-option.dev-div-run-option.
            <label for="start_script_url">URL for start-script
            span.in-circle(onclick='helpOnClick("start-script");') ?
            </label>
            <input type="url" id="start_script_url" name="start_script_url" class="url-input">
        #custom_sysout_row
          label.run-option.dev-div-run-option.
            <input type="checkbox" id="custom_sysout_cb" class="checkbox-input">&nbsp;Run custom sysout
          span.in-circle(onclick='helpOnClick("custom");') ?
        #custom_init_row
          label.run-option.dev-div-run-option.
            <input type="checkbox" id="custom_init_cb" class="checkbox-input">&nbsp;Use custom site init
          span.in-circle(onclick='helpOnClick("custom-init");') ?
        #sftp-label
          label.run-option.dev-div-run-option.
            <input type="checkbox" id="sftp_checkbox" class="checkbox-input">&nbsp;Start SFTP Server
          span.in-circle(onclick='helpOnClick("sftp");') ?
        #dev-div-buttons
          .text-center.dev-div-button
            button(type="button" onclick='startSession("xterm");').main-button Start Terminal Session
          .text-center.dev-div-button
            button(type="button" onclick='reset();').main-button Reset Home Directory

    dialog.vdialog#reconnect-dialog
        p You already have an <span id="rd-type-span">Interlisp</span> session running.
        p Do you want to <b>reconnect</b> to this session or
        p <b>kill</b> this session and start a new one?
        br
        .button-div
            button(type="button" onclick='rdDone("reconnect");').main-button Reconnect
            button(type="button" onclick='rdDone("kill");').main-button Kill

    dialog.vdialog#alert-dialog
        p <span id="alert-span">Alert</span>
        br
        .single-button-div
            button(type="button" onclick='alertOk();').main-button OK

    dialog.vdialog#verification-dialog1
        h2  Notice
        p.
            This account has not been verified.  You are free to use online.interlisp.org to
            explore the many wonders of Interlisp.
        p.
            However, any account that has not been verified within 7 days of its creation
            may be deleted without notice.
        p.
            A verification email was sent to #{login} when the account was created.  Please follow the
            directions in this email to verify your account.
        .single-button-div
            button(type="button" onclick='verificationClose(1, false);').main-button OK
        .single-button-div
            button(type="button" onclick='verificationClose(1, true);').main-button Resend Verification Email

    dialog.vdialog#verification-dialog2
        h2  Notice
        p.
            As part of the re-registration process, we are asking you to verify your email address.
            You are free to continue to use online.interlisp.org to
            explore the many wonders of Interlisp.
        p.
            However, if your account email is not been verified within the next 7 days, it
            may be deleted without notice.
        p.
            A verification email was just sent to #{login}.  Please follow the
            directions in this email to verify your account.
        .single-button-div
            button(type="button" onclick='verificationClose(2, false);').main-button OK

    script.
        function disclaimerCheckboxCallback() {
            fetch(`/user/nodisclaimer`).then(response => {console.log(response);});
        }

    include disclaimer.pug
    include help_dialogs.pug
