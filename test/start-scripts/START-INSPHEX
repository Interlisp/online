(DEFINE-FILE-INFO PACKAGE "INTERLISP" READTABLE "INTERLISP" BASE 10)

(FILECREATED " 7-Nov-2025 10:09:00" {DSK}<home>frank>il>online>test>start-scripts>START-INSPHEX.;8 2341   

      :EDIT-BY "FGH"

      :CHANGES-TO (VARS START-INSPHEXCOMS)
                  (FNS START-INSPHEX)

      :PREVIOUS-DATE " 6-Nov-2025 20:45:51" 
{DSK}<home>frank>il>online>test>start-scripts>START-INSPHEX.;2)


(PRETTYCOMPRINT START-INSPHEXCOMS)

(RPAQQ START-INSPHEXCOMS ((P (DEFPACKAGE "INSPHEX" (:USE "LISP" "XCL")))
                          (FUNCTIONS TmpShellWget)
                          (FNS START-INSPHEX)
                          (P (START-INSPHEX))))

(DEFPACKAGE "INSPHEX" (:USE "LISP" "XCL"))

(CL:DEFUN TmpShellWget (URL OUTFILENAME)
   (LET* ((WGET (ShellWhich "wget"))
          (OUTNAME (OUTFILEP OUTFILENAME))
          (UNIXNAME (LET [(UN (UNIX-FILE-NAME OUTNAME 'OUTPUT]
                         (if (STREQUAL (SUBSTRING UN (NCHARS UN))
                                    ".")
                             then (SUBSTRING UN 1 -2)
                           else UN)))
          (CMD (CONCAT WGET " " URL " -O " UNIXNAME)))
         (if (NULL WGET)
             then (ERROR "ShellWget - wget not available"))
         (ShellCommand CMD)
         OUTNAME))
(DEFINEQ

(START-INSPHEX
  [LAMBDA NIL                                                (* ; "Edited  7-Nov-2025 10:07 by FGH")
    (LET ((INSPHEX.FILE (CONCAT LOGINDIR ">INSPHEX"))
          INSPHEX.DFASL)
         (TmpShellWget "https://raw.githubusercontent.com/pamoroso/insphex/refs/heads/main/INSPHEX" 
                INSPHEX.FILE)
         (SETQ INSPHEX.DFASL (CL:COMPILE-FILE INSPHEX.FILE))
         (LOAD INSPHEX.DFASL)
         [ADVISE '(TEDIT IN INSPHEX::CREATE-HEX-WINDOW)
                'BEFORE
                '(SETQ WINDOW (CREATEW (CREATEREGION (FIX (TIMES 0.25 SCREENWIDTH))
                                              (FIX (TIMES 0.25 SCREENHEIGHT))
                                              (FIX (TIMES 0.5 SCREENWIDTH))
                                              (FIX (TIMES 0.5 SCREENHEIGHT]
         (ADD.PROCESS (LIST (CL:INTERN "HEXDUMP" (CL:FIND-PACKAGE "INSPHEX"))
                            (KWOTE INSPHEX.DFASL)
                            T])
)

(START-INSPHEX)
(DECLARE%: DONTCOPY
  (FILEMAP (NIL (705 1298 (TmpShellWget 705 . 1298)) (1299 2297 (START-INSPHEX 1309 . 2295)))))
STOP
